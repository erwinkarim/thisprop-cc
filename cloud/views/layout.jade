doctype html
html(lang='en')
	head
		title ThisProp
		link(href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css', rel='stylesheet')
		link(href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css', rel="stylesheet')
		link(href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css", rel="stylesheet")
	body
		.navbar.navbar-default(role='navigation')
			.container-fluid
				.navbar-header
					button.navbar-toggle.collasped(type='button', data-target='#the-navbar', data-toggle='collapse')
						span.sr-only Toggle Navigation
						span.icon-bar
						span.icon-bar
						span.icon-bar
					a.navbar-brand(href='#') ThisProp
				.navbar-collapse.collapse#the-navbar
					ul.nav.navbar-nav
						li
							a(href='#') Buy
						li
							a(href='#') Sell
					ul.nav.navbar-nav.navbar-right#user-menu
						li
							a(href='#')
								i.fa.fa-lg.fa-cog.fa-spin
		block body
		.fb-like(data-share='true', data-width='450', data-show-faces='true')
script(src='http://code.jquery.com/jquery-2.1.3.min.js')
script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js')
script(src='http://www.parsecdn.com/js/parse-1.3.5.min.js')
script
	Parse.initialize("oR8lLc6Rwxtdnfc70vUA4UTa5gZkk3Zh8xkf2f2A", "Mv1QKomwzfLAXFsSdGcAfBqqZUB6URPWgw8s34Sq");
	var graph_path = 'https://graph.face.com/v2.2';

	window.fbAsyncInit = function() {
		Parse.FacebookUtils.init({ 
		appId			 : '591760294291555', // Facebook App ID
		status		 : true,	// check Facebook Login status
		cookie		 : true,	// enable cookies to allow Parse to access the session
		xfbml			 : true,	// initialize Facebook social plugins on the page
		version		 : 'v2.2' // point to the latest Facebook Graph API version
		});

		console.log('parse loaded');

		//plan
		//check login status
		//put the appropiate menu
		//handle login/logout event
		FB.getLoginStatus(function(response) {
			$.get('/login-menu', { status:response.status}, function(data){
				$('#user-menu').empty().append(data).ready( function(){
					$('#logout-fb').click(function(){
						console.log('logout clicked');
						FB.logout();
					});
					$('#login-fb').click(function(){
						console.log('login clicked');
						Parse.FacebookUtils.logIn('public_profile,email', {
							success: function(user) {
								if (!user.existed()) {
									console.log("User signed up and logged in through Facebook!");
								} else {
									console.log("User logged in through Facebook!");
								}
								//get and set the name and others
								$.get(graph_path + '/me', {access_token:FB.getAccessToken()}, function(data){
									console.log(data);
								});
							},
							error: function(user, error) {
								console.log("User cancelled the Facebook login or did not fully authorize.");
							}
						}); // Parse.FacebookUtils.logIn(null, {
					});
				});
			});
		});
	};

	(function(d, s, id){
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) {return;}
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));

	$(document).ready(function(){
		//handle login/logout event

		$('#login-fb').click( function(){
			console.log('attempt to login facebook');
		});

		$('#logout-fb').click( function(){
		});
	});

